<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ultimate Flappy Bird</title>
<style>
body {
    margin: 0;
    overflow: hidden;
    background: linear-gradient(#70c5ce, #ffffff);
    font-family: Arial, sans-serif;
    text-align: center;
}

canvas {
    display: block;
    margin: auto;
    background: linear-gradient(#70c5ce, #e0f7ff);
}

#ui {
    position: absolute;
    width: 100%;
    top: 20px;
    color: white;
    font-size: 24px;
    font-weight: bold;
    text-shadow: 2px 2px 4px black;
}

button {
    padding: 12px 20px;
    font-size: 18px;
    border: none;
    border-radius: 10px;
    background: #ffcc00;
    cursor: pointer;
}

button:hover {
    background: #ff9900;
}
</style>
</head>
<body>

<div id="ui">
    <div id="scoreText"></div>
    <div id="menu">
        <h1>üê§ ULTIMATE FLAPPY</h1>
        <button onclick="startGame()">Start Game</button>
        <p>Tap / Click / Press Space</p>
        <p>High Score: <span id="highScoreText">0</span></p>
    </div>
</div>

<canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let bird, pipes, score, highScore = localStorage.getItem("flappyHigh") || 0;
let gravity = 0.5;
let lift = -9;
let gameRunning = false;
let frame = 0;

document.getElementById("highScoreText").innerText = highScore;

function startGame() {
    bird = {
        x: 100,
        y: canvas.height/2,
        radius: 20,
        velocity: 0
    };

    pipes = [];
    score = 0;
    frame = 0;
    gameRunning = true;
    document.getElementById("menu").style.display = "none";
    document.getElementById("scoreText").innerText = "Score: 0";
    loop();
}

function endGame() {
    gameRunning = false;
    if(score > highScore) {
        highScore = score;
        localStorage.setItem("flappyHigh", highScore);
    }
    document.getElementById("menu").style.display = "block";
    document.getElementById("highScoreText").innerText = highScore;
}

function drawBird() {
    ctx.beginPath();
    ctx.arc(bird.x, bird.y, bird.radius, 0, Math.PI*2);
    ctx.fillStyle = "yellow";
    ctx.fill();
}

function createPipe() {
    let gap = 170;
    let topHeight = Math.random() * (canvas.height - gap - 200) + 50;
    pipes.push({
        x: canvas.width,
        width: 70,
        top: topHeight,
        bottom: topHeight + gap,
        passed: false
    });
}

function drawPipes() {
    pipes.forEach(pipe => {
        ctx.fillStyle = "green";
        ctx.fillRect(pipe.x, 0, pipe.width, pipe.top);
        ctx.fillRect(pipe.x, pipe.bottom, pipe.width, canvas.height);

        pipe.x -= 3;

        if(!pipe.passed && pipe.x + pipe.width < bird.x) {
            pipe.passed = true;
            score++;
            document.getElementById("scoreText").innerText = "Score: " + score;
            playSound(600);
        }

        if(
            bird.x + bird.radius > pipe.x &&
            bird.x - bird.radius < pipe.x + pipe.width &&
            (bird.y - bird.radius < pipe.top || bird.y + bird.radius > pipe.bottom)
        ) {
            playSound(200);
            endGame();
        }
    });

    pipes = pipes.filter(pipe => pipe.x + pipe.width > 0);
}

function update() {
    bird.velocity += gravity;
    bird.y += bird.velocity;

    if(bird.y + bird.radius > canvas.height || bird.y - bird.radius < 0) {
        playSound(200);
        endGame();
    }

    if(frame % 90 === 0) createPipe();
}

function loop() {
    if(!gameRunning) return;

    ctx.clearRect(0, 0, canvas.width, canvas.height);

    update();
    drawBird();
    drawPipes();

    frame++;
    requestAnimationFrame(loop);
}

function flap() {
    if(!gameRunning) return;
    bird.velocity = lift;
    playSound(800);
}

document.addEventListener("keydown", e => {
    if(e.code === "Space") flap();
});
document.addEventListener("click", flap);
document.addEventListener("touchstart", flap);

function playSound(freq) {
    let ctxAudio = new (window.AudioContext || window.webkitAudioContext)();
    let osc = ctxAudio.createOscillator();
    osc.type = "square";
    osc.frequency.value = freq;
    osc.connect(ctxAudio.destination);
    osc.start();
    osc.stop(ctxAudio.currentTime + 0.1);
}

window.addEventListener("resize", () => {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
});
</script>

</body>
</html>
